%#
%# $Id$
%#
% layout 'default';
% title 'Dumper';
% use Mojo::Util qw(dumper);

% my $req = $self->req;

% my $hostname = $req->param('hostname');
% my $username = $req->param('username');
% my $password = $req->param('password');

% my $m = $self->app->model;
% my $agent_id = $m->agent_exist($hostname);

% my $job_id = $m->job_create;
% $m->job_update(
%    $job_id, 
%    type => 'agentadd',
%    sourceid => $agent_id,
%    destid => $agent_id, 
%    author => $c->session('username')
% );

% if ($agent_id) {
    <div class="callout alert">
        Agent <%= $hostname %> yet exist.
    </div>
%   $m->job_update($job_id, status => 'mistake', error => 'agentexist', stop => $m->timestamp);
% }

% unless ($agent_id) {
%     my $agent_id = $m->agent_add($hostname, $username, $password);
%     if ($agent_id) {
        <div class="callout success">
        Agent <%= $hostname %> was added successful with id <%= $agent_id %>.
        </div>
        <div class="text-center">
          <a class="button" href="/agent/list">Agent List</a>
          <a class="button" href="/agent/db/list?id=<%= $agent_id %>">DBList</a>
          <a class="button" href="#" data-open="modal-agent-add">Add yet</a>
        </div>
%       $m->job_update($job_id, status => 'done', error => 'noerr', stop => $m->timestamp);
%     }

%     unless ($agent_id) {
          <div class="callout alert">
          Agent <%= $hostname %> was added unsuccessful.
          </div>
          <div class="text-center">
              <a class="button" href="/agent/list">Agent List</a>
              <a class="button" href="#" data-open="modal-agent-add">Add yet</a>
          </div>
%         $m->job_update($job_id, status => 'error', error => 'agentadderr', stop => $m->timestamp);
%     }
% }
%#EOF

